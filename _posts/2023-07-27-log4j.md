---
title:  "log4j 漏洞"
categories: 
  - 漏洞分析
---
对应CVE-2021-44228

漏洞在12月10号暴出来

12月4号官方库有提交，限制了JNDI访问：https://github.com/apache/logging-log4j2/commit/c77b3cb39312b83b053d23a2158b99ac7de44dd3

之后又发现其他利用方式，cve-2021-45046

12月12号默认关闭了JNDI： https://github.com/apache/logging-log4j2/commit/c362aff473e9812798ff8f25f30a2619996605d5

12月13号将message lookup功能彻底删除：https://github.com/apache/logging-log4j2/commit/27972043b76c9645476f561c5adc483dec6d3f5d

> Log4j 2.16.0 fixes this issue by removing support for message lookup patterns and disabling JNDI functionality by default. This issue can be mitigated in prior releases (< 2.16.0) by removing the JndiLookup class from the classpath (example: zip -q -d log4j-core-*.jar org/apache/logging/log4j/core/lookup/JndiLookup.class).
>
> Log4j 2.15.0 restricts JNDI LDAP lookups to localhost by default. Note that previous mitigations involving configuration such as to set the system property log4j2.formatMsgNoLookups to true do NOT mitigate this specific vulnerability.

后续对其他地方的JNDI使用也做了限制
- https://github.com/apache/logging-log4j2/commit/ab2fb451d248702880a231646dace6b3ec9d98c2
- https://github.com/apache/logging-log4j2/commit/be97ee03cd5081b66b28c029fb3b10d3ce57b1f8
- https://github.com/apache/logging-log4j2/commit/80eaa5cdaef536c2163aa3a230ddaee24e03a4ff
- https://github.com/apache/logging-log4j2/commit/8e18c130c7094b12138d7fab6b91bd8701ff00ee
